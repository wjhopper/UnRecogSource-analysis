---
title: "UnrecogSource Descriptive Analysis"
author: "Will Hopper"
date: "`r format(Sys.Date(), '%m-%d-%Y')`"
output: html_document
---

```{r include=FALSE}
knitr::opts_chunk$set(echo=FALSE, fig.align="center")
library(rprojroot)
library(ggplot2)
library(ggExtra)
library(scales)
library(tidyr)
library(dplyr)
root_dir <- rprojroot::is_rstudio_project$find_file()
source(file.path(root_dir, "R", "preprocessing.R"))
```

```{r load_data}
unrecog_source <- load_data(file.path(root_dir, "data"))
missing_trials <- filter(unrecog_source, is.na(response))
# Remove trials with no response from further analysis
unrecog_source <- filter(unrecog_source, !is.na(response))
source_data <- filter(unrecog_source, task == "source")
recog_data <- filter(unrecog_source, task == "recog")
```

```{r accuracy, fig.width=7, fig.height=7}
subject_acc <- group_by(unrecog_source, subj, task) %>%
  summarise(acc = mean(corr))

{ ggplot(spread(subject_acc, task, acc),
       aes(x=source, y=recog)) +
  geom_point(size= 2) +
  scale_x_continuous("Source Memory Accuracy", limits = c(0,1),
                     labels = scales::percent) +
  scale_y_continuous("Recognition Memory Accuracy", limits = c(0,1),
                     labels = scales::percent) +
  coord_fixed() +
  ggtitle("Source vs. Recognition Memory") +
  theme_bw(base_size = 16) +
  theme(plot.title = element_text(hjust=0.5))
} %>%
  ggMarginal(type = "histogram")
```

```{r encoding_tasks, fig.width=12, fig.height=7}
encoding_tasks <- filter(unrecog_source, type != "lure") %>%
  group_by(subj, encoding, task) %>%
  summarise(acc = mean(corr))

ggplot(encoding_tasks, aes(x=acc, fill=encoding)) +
  geom_histogram(bins=20, alpha=.4, position="identity") +
  facet_grid(~task, labeller = as_labeller(c("source"="Source",
                                             "recog"="Recognition"))
             ) +
  scale_fill_discrete(guide = guide_legend(override.aes = list(alpha=1))) +
  scale_x_continuous("Hit Rate (studied items only)") +
  ggtitle("Accuracy by Encoding Task") +
  theme_bw(base_size = 16) +
  theme(plot.title = element_text(hjust=0.5))
```

```{r word_frequency, fig.width=12, fig.height=7}
word_freq <- group_by(unrecog_source, subj, wf, task) %>%
  summarise(acc = mean(corr))

ggplot(spread(word_freq, task, acc), aes(x=source, y=recog)) +
  geom_point(size=2) +
  geom_rug(size=0.1) +
  facet_grid(~wf, labeller = as_labeller(c("LF"="Low Frequency",
                                           "HF"="High Frequency"))
             ) +
  scale_x_continuous("Source Memory Accuracy", limits = c(0,1),
                     labels = scales::percent) +
  scale_y_continuous("Recognition Memory Accuracy", limits = c(0,1),
                     labels = scales::percent) +
  coord_fixed() +
  ggtitle("Accuracy by Word Frequency") +
  theme_bw(base_size = 16) +
  theme(plot.title = element_text(hjust=0.5))
```

```{r bias}
bias_effects <- group_by(recog_data, subj, bias, type) %>%
  summarise(p = mean(corr)) %>%
  spread(type, p) %>%
  mutate(lure = 1-lure,
         diff = target-lure) %>%
  rename(HR = target, FAR = lure)

avg_bias_effects <- group_by(bias_effects, bias) %>%
  summarise_at(c("FAR", "HR"), mean)

ggplot(bias_effects, aes(x=FAR, y=HR, color=bias)) +
  geom_point() +
  geom_path(mapping=aes(group=subj), color="black") +
  geom_point(data=avg_bias_effects, stroke=3, shape=4)



knitr::kable(bias_effects, col.names = c("Subject", "Bias", "FAR", "HR", "HR - FAR"),
             digits=3, format="html") %>%
  kableExtra::kable_styling(full_width = FALSE) %>%
  kableExtra::collapse_rows(columns = 1)
```

